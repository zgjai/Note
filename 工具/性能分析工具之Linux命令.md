# TOP

### 本系列Linux命令均基于[图0](#0)系统实践。

<h5 id="0">图0</h5>
![](http://o793hh4oz.bkt.clouddn.com/14779627738663.jpg)


top是在服务器上查看系统整体负载与运行情况的非常好的命令。本篇将具体介绍其功能与使用。

<h5 id="1-1">图1-1</h5>
![](http://o793hh4oz.bkt.clouddn.com/14776543048170.jpg)

[图1-1](#1-1)是运行 **top** 时的截图，这些信息可以从图中白行分隔为两部分。上面部分是系统运行时整体信息，包括load、cpu使用、内存使用等等；下面部分是当前系统中存在的进程，他们是按某个条件排序的，比如cpu占用时间，这个排序规则是可以调整的，后续会具体讲。

### 第一部分
下面从第一行开始具体了解一下每一行的含义。

<h5 id="1-2">图1-2</h5>
![](http://o793hh4oz.bkt.clouddn.com/14779629898855.jpg)
[图1-2](#1-2)是第1行的截图。
表示的信息为:

* 当前时间，即 **09:02:18**
* 系统已运行的时间，即 **286days,14:51**
* 当前登陆用户数量，即 **1 user**
* load均值，即 **3.18,2.87,2.59**

其中需要注意的是load，它有3个值，分别表示1分钟内，5分钟内，15分钟内的load均值。5跟15分钟的值是相对重要的，因为可能1分钟内的load比较高，但很快就降回去了，没有持续很久。load反映的当前CPU的负载状况，当一个CPU核心的load值(load/cpu核心数)为1时，表示已经满载了，其实就需要立即处理了，一般大于0.7时，就应该调整系统或者增加CPU核心了。具体的关于load的介绍请参考[UNDERSTANDING LINUX CPU LOAD](http://blog.scoutapp.com/articles/2009/07/31/understanding-load-averages)

<h5 id="1-3">图1-3</h5>
![](http://o793hh4oz.bkt.clouddn.com/14779629963652.jpg)
[图1-3](#1-3)是第2行的截图。
表示的信息为:

* 系统中总的进程数，即 **614 total**
* 系统中正在运行的进程数，即 **1 running**
* 正在睡眠的进程数，即 **63 sleeping**
* 停止的进程数，即 **0 stopped**
* 僵尸进程数，即 **0 zombie**

<h5 id="1-4">图1-4</h5>
![](http://o793hh4oz.bkt.clouddn.com/14779630074519.jpg)
[图1-4](#1-4)是第3行的截图。
表示的信息为:

* 用户(us, user)进程(未调整优先级的)占用的CPU时间，即 **13.5%us**
* 系统(sy, system)进程占用的CPU时间，即 **0.3%sy**
* 已调整优先级(ni, niced)的进程占用的CPU时间，即 **0.0%ni**
* 空闲(id, idle)CPU时间，即 **86.2%id**
* 等待输入输出(wa, IO wait)的CPU时间，即 **0.0%wa**
* 处理硬件中断(hi, hardware)的CPU时间，即 **0.0%hi**
* 处理软件中断(si, software)的CPU时间，即 **0.0%si**
* 这个虚拟机被hypervisor偷去的CPU时间，如果当前处于一个hypervisor下的vm，实际上hypervisor也是要消耗一部分CPU处理时间的，即 **0.0%st**

<h5 id="1-5">图1-5</h5>
![](http://o793hh4oz.bkt.clouddn.com/14779630159060.jpg)
[图1-5](#1-5)是第4行的截图。
表示的信息为:

* 全部可用物理内存，即 **65980420k total**
* 已使用物理内存，即 **65714000k used**
* 空闲物理内存，即 **266420k free**
* 缓冲区占用的内存，即 **89380k buffers**

<h5 id="1-6">图1-6</h5>
![](http://o793hh4oz.bkt.clouddn.com/14779630239953.jpg)
[图1-6](#1-6)是第5行的截图。
表示信息为:

* 交换区总量，即 **50331644k total**
* 已使用的交换区，即 **0k used**
* 空闲的交换区，即 **50331644k free**
* 缓存占用的内存，即 **11463508k cached**


### 未完待续。。。



### 续

### 第二部分

<h5 id="1-7">图1-7</h5>
![](http://o793hh4oz.bkt.clouddn.com/14788277434530.jpg)

[图1-7](#1-7)就是TOP命令第二部分的内容。
每一行是一个进程相关信息，每一列是一个系统属性。

* PID  
    进程的id  
* USER  
    进程所有者  
* PR  
    进程的调度优先级，值越小优先级越高。这个字段的一些值是'RT'。这意味这这些进程运行在实时态。  
* NI  
    nice值，也会影响进程的优先级。
* VIRT  
    进程占用的虚拟内存
* RES  
    进程占用的物理内存
* SHR  
    进程占用的共享内存
* S  
    进程的状态。
    * D 不可中断的睡眠态
    * S 睡眠态
    * R 运行态
    * Z 僵死态
    * T 被跟踪或已终止
    * N 该进程优先级为负数
* %CPU  
    从上次更新到现在，进程占用CPU的使用率
* %MEM  
    进程占用的物理内存的百分比
* TIME+  
    该进程启动后占用的总的CPU时间
* COMMAND  
    启动该进程的命令


### 第三部分

下面介绍一些与TOP命令的交互快捷键

* q  
    退出TOP命令
* 回车 或 空格  
    top命令默认在一个特定间隔(3秒)后刷新显示。要手动刷新，可以输入回车或者空格。
* s 或 d  
    设置刷新时间间隔
* c  
    切换是否显示进程启动时的完整路径和程序名
* i  
    切换显示空闲任务
* x 或 y  
    切换高亮信息：'x'将排序字段高亮显示（纵列）；'y'将运行进程高亮显示（横行）
* u  
    显示特定用户的进程
* n 或 #  
    设置最大显示的任务数量
* k  
    用于发送信号给任务（通常是结束任务）
* r  
    重新设置一个任务的调度优先级
* S  
    累计模式，会把已完成或退出的子进程占用的CPU时间累计到父进程的MITE+
* P  
    按%CPU使用率排行
* T  
    按MITE+排行
* M  
    按%MEM排行
* W
    保存对top的设置到文件^/.toprc，下次启动将自动调用toprc文件的设置
* 1
    切换多核CPU显示

